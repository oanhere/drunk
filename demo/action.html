<!doctype html>
<html>
    <head>
        <meta charset="utf-8" />
        <title>drunk.Action - demo</title>
        <script src="../build/drunk.js"></script>
        <style>
            .msg {
              transition: all .3s ease;
              height: 0px;
              background-color: #eee;
              overflow: hidden;
              opacity: 0;
            }
            .msg.expand-enter {
                height: 30px;
                opacity: 1;
            }
            .msg.expand-leave {
              height: 0;
              opacity: 0;
            }
            .blackbox {
                background-color: #333;
                width: 300px;
                height: 100px;
                transition: all 0.4s cubic-bezier(0, 0, 0, 1);
                opacity: 0;
                transform: translateX(100px);
                margin: 5px 0;
            }
            .blackbox.box-enter {
                opacity: 1;
                transform: translate(0px);
            }
            .blackbox.box-leave {
                opacity: 0;
                transform: translate(100px);
            }
            
            .redbox {
                background: red;
                width: 100px;
                height: 100px;
            }
            .redbox.bounce-enter {
              animation: bounce-in .5s none;
            }
            .redbox.bounce-leave {
              animation: bounce-out .5s none;
            }
            
            .greenbox {
                background-color: green;
                width: 100px;
                height: 100px;
            }
            @keyframes bounce-in {
              0% {
                transform: scale(0);
              }
              50% {
                transform: scale(1.5);
              }
              100% {
                transform: scale(1);
              }
            }
            @keyframes bounce-out {
              0% {
                transform: scale(1);
              }
              50% {
                transform: scale(1.5);
              }
              100% {
                transform: scale(0);
              }
            }
        </style>
    </head>
    
    <body>
        <button drunk-on="click:show = !show">点击切换文本展示</button>
        <button drunk-on="click:list.unshift({})">从列表头部添加一个</button>
        <button drunk-on="click:list.push({})">从列表尾部添加一个</button>
        <button drunk-on="click:list.pop()">从列表中移除一个</button>
        <button drunk-on="click:redBoxVisible = !redBoxVisible">点击切换动画</button>
        <button drunk-on="click:greenBoxVisible = !greenBoxVisible">点击切换动画</button>
        
        <!--<div class="msg" drunk-if="show" drunk-action="expand">Hello!</div>-->
        <div class="msg" drunk-show="show" drunk-action="expand">World!</div>
        <div class="blackbox" drunk-repeat="e,i in list" drunk-action="{{i * 0.1}} box"></div>
        <div class="redbox" drunk-if="redBoxVisible" drunk-action="bounce"></div>
        <div class="greenbox" drunk-if="greenBoxVisible" drunk-action="fade"></div>
        
        <script>
            
            drunk.Action.register('fade', {
                enter: function (element, done) {
                    element.style.opacity = 0;
                    
                    var timerid = setInterval(function () {
                        var opacity = Number(getComputedStyle(element, null).opacity);
                        
                        if (opacity >= 1) {
                            cancel();
                            done();
                            return;
                        }
                        
                        element.style.opacity = opacity + 0.3;
                    }, 50);
                    
                    function cancel() {
                        clearInterval(timerid);
                    }
                    
                    return cancel;
                },
                leave: function (element, done) {
                    element.style.opacity = 1;
                    
                    var timerid = setInterval(function () {
                        var opacity = Number(getComputedStyle(element, null).opacity);
                        
                        if (opacity <= 0) {
                            cancel();
                            done();
                            return;
                        }
                        
                        element.style.opacity = opacity - 0.3;
                    }, 50);
                    
                    function cancel() {
                        clearInterval(timerid);
                    }
                    
                    return cancel;
                }
            });
            
            var app = new drunk.Component({
                list: [1,2,3]
            });
            app.mount(document.body);
        </script>
    </body>

</html>